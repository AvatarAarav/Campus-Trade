<!DOCTYPE html>
<html>

<head>
    <title>User Profile</title>
    <!-- <link rel="stylesheet" href="http://localhost:3000/user_style.css"> -->
    <script src="http://localhost:3000/USER_PROFILE.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://kit.fontawesome.com/ef8a591cb3.js" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>

    <style>
         :root {
            --blue1: #142850;
            --blue2: #27496D;
            --blue3: #0C7B93;
            --blue4: #00A8CC;
            --bisket: rgb(251, 218, 174);
            --yello: #F1F7B5;
            --redd: #FD8A8A;
            --newRed: #ED2647;
        }
        
        body {
            display: flex;
            flex-direction: column;
            justify-content: center;
            font-family: Arial, Helvetica, sans-serif;
            padding: 0px;
            margin: 0px;
            background-color: whitesmoke;
        }
        
        .nav-item a {
            color: white;
        }
        
        .nav-item a:hover {
            color: #333;
        }
        
        .logo {
            font-size: 40px;
            color: var(--blue1);
            padding: 0px;
            margin: 0px 5px 0px 0px;
        }
        
        .heading {
            padding: 0px;
            margin: 0px 10px -15px 5px;
            color: white;
            /* background-color: red; */
        }
        
        h1 {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .searchbar {
            background-color: var(--blue1);
        }
        
        .inpsearch {
            width: 90%;
            padding-left: 20px;
            border: none;
            border-top-left-radius: 15px;
            border-bottom-left-radius: 15px;
            border-top-right-radius: 0;
            border-bottom-right-radius: 0;
        }
        
        .inpsearch:focus {
            outline: none;
        }
        
        .searchbtn {
            width: 35px;
            height: 35px;
            background-color: var(--blue4);
            border: none;
            margin: 0;
            padding-right: 20px;
            border-top-right-radius: 15px;
            border-bottom-right-radius: 15px;
            border-top-left-radius: 0;
            border-bottom-left-radius: 0;
        }
        
        .searchbtn:hover {
            background-color: orange;
            cursor: progress;
        }
        
        .menubtn {
            display: none;
            background-color: var(--blue1);
            border: none;
        }
        
        .navbar-toggler-icon {
            color: white;
        }
        
        .navvbar {
            height: 82px;
            padding: 30px;
            margin: 0;
            background-color: var(--newRed);
            position: relative;
        }
        
        .extendednav {
            height: 320px;
            background-color: lightblue;
            border-bottom-right-radius: 500px;
            /* box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19); */
        }
        
        .boxxx {
            /* background-color: lightgreen; */
            z-index: 1;
            display: flex;
            justify-content: flex-end;
        }
        
        .parentNavbox {
            margin-top: -30px;
        }
        /* .searchbox {
            background-color: lightpink; 
        } */
        
        .navbox {
            display: flex;
            justify-content: space-evenly;
        }
        
        .imgbox {
            width: 600px;
            position: absolute;
            top: 20;
            /* background-color: lightpink; */
        }
        /* BODY */
        
        .ancestor {
            width: 90%;
            display: flex;
            justify-content: space-evenly;
            background-color: whitesmoke;
            padding: 20px;
            border-radius: 20px;
            margin-top: 40px;
        }
        
        .users {
            width: 30%;
            height: 600px;
            background-color: #f2b995;
            border-radius: 10px;
            margin-top: -20px;
            margin-left: -100px;
            padding: 15px;
            border: 2px solid #333;
        }
        
        .users hr {
            color: #333;
            height: 3px;
            background-color: #333;
        }
        
        .namebox a {
            font-size: 20px;
            color: black;
            text-decoration: none;
        }
        
        .namebox a:hover {
            color: var(--newRed);
        }
        
        .large {
            width: 50%;
            border-radius: 10px;
            margin-top: 40px;
            background-color: white;
            border: 1px solid black;
            box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);
        }
        
        .profileinfo {
            display: flex;
            flex-direction: column;
            align-items: start;
            margin: 30px 0 0 30px;
        }
        
        .profileinfo p {
            margin-bottom: 0;
        }
        
        .profileinfo i {
            color: grey;
        }
        
        .postadd {
            float: right;
            margin: -10px 10px 10px 0;
            background-color: orange;
            color: white;
        }
        
        .postadd:hover {
            background-color: var(--blue1);
            color: white;
        }
        
        .addbox {
            width: 90%;
            display: flex;
            flex-direction: column;
            align-items: start;
            /* background-color: palevioletred; */
        }
        
        .add-container {
            width: 100%;
            height: 350px;
            overflow: auto;
        }
        
        .c-body {
            padding: 0 0 10px 10px;
        }
        
        .short {
            width: 23%;
            height: 50%;
            background-color: white;
            margin-right: -120px;
            margin-top: -45px;
            border-radius: 10px;
            border: 1px solid black;
            /* box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19); */
        }
        /* Footer Styles */
        
        footer {
            width: 100%;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #384745;
            color: white;
        }
        
        .fbox {
            display: flex;
            justify-content: space-around;
            align-items: center;
        }
        
        footer li {
            text-decoration: none;
            list-style-type: none;
            margin: 10px 0 10px 0;
        }
        
        footer a {
            color: white;
            text-decoration: none;
            font-style: none;
        }
        
        footer a:hover {
            color: greenyellow;
        }
        
        footer i {
            color: white;
        }
        
        footer hr {
            display: none;
        }
        
        @media (max-width: 576px) {
            footer hr {
                display: block;
            }
            .fbox {
                flex-direction: column;
            }
            .address {
                flex-direction: column;
                align-items: center;
            }
        }
        
        @media (max-width: 576px) {
            .menubtn {
                display: block;
            }
            .extendednav {
                height: 160px;
            }
            .boxxx {
                margin-top: 10px;
                flex-direction: column;
                align-items: start;
                background-color: var(--blue4);
                padding: 20px;
                border-radius: 30px;
                color: black;
                box-shadow: 0 4px 8px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);
            }
            .ancestor {
                width: 98%;
            }
            .large {
                width: 100%;
            }
            .short {
                display: none;
            }
            .menuu {
                background-color: var(--blue4);
                padding: 20px;
                margin-top: -15px;
                margin-right: -28px;
                border-bottom-left-radius: 30px;
            }
            .searchbtn {
                background-color: var(--redd);
            }
            .tophead {
                margin: 60px 0 30px 0;
            }
        }
    </style>
</head>

<body>
    <%- include('./admin_navbar2.ejs',{user : user}); %>



        <div class="container ancestor">
            <div class="users">
                <h4 style="text-align: center; background-color:#333;border-top-left-radius: 8px;border-top-right-radius: 8px; color: white; margin: -15px -15px 10px -15px; padding: 10px;"><span><i class="fa-solid fa-magnifying-glass"></i></span> Customers</h4>
                <form class="form d-flex my-2 my-lg-0 searchbox" id="user_search">
                    <input class="inpsearch" type="search" placeholder="User Name" aria-label="Search">
                    <button class="searchbtn" type="submit"><i class="fa-solid fa-magnifying-glass"></i></button>
                </form>
                <hr>

                <!-- <div class="namebox" style="display: flex;flex-direction: column; align-items: center;">
                    <a href="#">Aarav</a>
                    <a href="#">Parth</a>
                    <a href="#">Kumar</a>
                    <a href="#">Harshan</a>
                    <a href="#">Pratyush</a>
                </div> -->

                <div style="height: 450px;overflow-y: scroll;">
                    <div class="list-group" id="user_change">

                    </div>
                </div>


            </div>



            <div class="large">
                <h4 style="background-color: var(--blue1);padding: 20px;margin: 0;border-top-left-radius: 10px;border-top-right-radius: 10px;margin-bottom: 30px;font-style: oblique;font-size: xx-large;color: whitesmoke;">Dashboard</h4>

                <div class="container-fluid" style="width: 80%;">
                    <div class="row row-cols-2">
                        <div class="col">
                            <h6 style="text-align: center;">Active Users</h6>
                            <div class="numbox" style="display: flex;justify-content: center;align-items: center;width: 100%;height: 180px;background-color: #F1F7B5;border-radius: 20px; margin-bottom: 30px;font-size: xxx-large;color: darkgoldenrod;">234</div>
                        </div>
                        <div class="col">
                            <h6 style="text-align: center;">Sellers</h6>
                            <div class="numbox" style="display: flex;justify-content: center;align-items: center;width: 100%;height: 180px;background-color: greenyellow;border-radius: 20px; margin-bottom: 30px;font-size: xxx-large;color: darkgreen;">12</div>
                        </div>
                        <div class="col">
                            <h6 style="text-align: center;">Products</h6>
                            <div class="numbox" style="display: flex;justify-content: center;align-items: center;width: 100%;height: 180px;background-color: violet;border-radius: 20px; margin-bottom: 30px;font-size: xxx-large;color: darkviolet;">543</div>
                        </div>
                        <div class="col">
                            <h6 style="text-align: center;">Sold Out</h6>
                            <div class="numbox" style="display: flex;justify-content: center;align-items: center;width: 100%;height: 180px;background-color: orange;border-radius: 20px; margin-bottom: 30px;font-size: xxx-large;color: darkred;">23</div>
                        </div>
                    </div>
                </div>



            </div>

            <div class="short" style="padding: 0px;">

                <div class="bg" style="width:100%;height: 80px;padding-top: 0px; border-top-right-radius: 10px; border-top-left-radius: 10px; background-color: skyblue; ">
                    <img src="http://localhost:3000/assets/kinglarge.png" style="margin-left: 120px;" class="rounded-circle img-thumbnail mt-5" alt="dummyPic" width="100" height="100">
                </div>


                <div class="profileinfo">
                    <p style="font-size: 25px;padding: 0px; color:#27496D;">
                        <%=user.name %>
                    </p>
                    <p><span style="color:#142850; font-weight: bolder;"><i class="fa-solid fa-location-dot"></i>&nbsp;&nbsp; </span>India</p>
                    <p><span style="color:#142850; font-weight: bolder;"><i class="fa-solid fa-user"></i>&nbsp;&nbsp; </span> <span style="color: grey;">99999999+</span></p>

                    <p><span style="color:#142850; font-weight: bolder;"><i class="fa-solid fa-envelope"></i>&nbsp;&nbsp; </span>
                        <%=user.email %>
                            </span>
                    </p>
                    <p><span style="color:#142850; font-weight: bolder;"><i class="fa-solid fa-landmark"></i>&nbsp;&nbsp; </span> Sri City
                        </span>
                    </p>
                    <!-- <form class="d-inline" style="width: 100%;" method="POST" action="/api/user/adCreate">

                        <b><button class="btn postadd" type="submit"><span><i class="fa-solid fa-plus" style="color: white;"></i></span>Admin</button></b>
                    </form> -->

                </div>


            </div>


        </div>

        <hr style="width: 90%; height: 4px; background-color: grey;margin-left: 50px;">

        <div class="container ancestor">
            <div class="addbox">
                <div style="width: 100%;display: flex; justify-content: space-between;margin-bottom: 0;">
                    <h2 style="width: 100%;text-align: center; color: #142850;">All Products</h2>
                    <form class="form d-flex my-0 my-lg-0 searchbox" id="admin_product">
                        <input class="inpsearch" style="height: 35px; width: 270px;background-color: skyblue;" type="search" placeholder="Product Name" aria-label="Search">
                        <button class="searchbtn" style="background-color:red;" type="submit"><i class="fa-solid fa-magnifying-glass"></i></button>
                    </form>

                </div>
                <hr style="width: 100%; height: 4px; background-color: grey;margin: 0px;">


                <div class="add-container" id="add-container-1">






                </div>
            </div>
        </div>

        <hr style="width: 90%; height: 4px; background-color: grey;margin-left: 50px;">



        <br>


        <div class="parentbox container" style="display: flex;justify-content: center;align-items: center;">
            <div style="width: 50%;">
                <div id="demo" class="carousel slide car" style="width: 100%;" data-bs-ride="carousel">

                    <!-- Indicators/dots -->
                    <div class="carousel-indicators">
                        <button type="button" data-bs-target="#demo" data-bs-slide-to="0" class="active"></button>
                        <button type="button" data-bs-target="#demo" data-bs-slide-to="1"></button>
                        <button type="button" data-bs-target="#demo" data-bs-slide-to="2"></button>
                    </div>

                    <!-- The slideshow/carousel -->
                    <div class="carousel-inner" style="width: 100%;">
                        <div class="carousel-item active">
                            <img class="img-fluid" src="http://localhost:3000/assets/ancmt2.jpeg" alt="pic1" class="d-block" style="width: 550px;">
                        </div>
                        <div class="carousel-item">
                            <img class="img-fluid" src="http://localhost:3000/assets/ancmt1.png" alt="pic2" class="d-block" style="width: 550px;">
                        </div>
                        <!-- <div class="carousel-item">
                            <img class="img-fluid" src="./assets/ancmt3.jpeg" alt="pic3" class="d-block" style="width: 550px;">
                        </div> -->
                    </div>

                    <!-- Left and right controls/icons -->
                    <button class="carousel-control-prev" type="button" data-bs-target="#demo" data-bs-slide="prev">
                        <span class="carousel-control-prev-icon"></span>
                    </button>
                    <button class="carousel-control-next" type="button" data-bs-target="#demo" data-bs-slide="next">
                        <span class="carousel-control-next-icon"></span>
                    </button>
                </div>
            </div>

            <div class="container" style="width: 50%;background-color: whitesmoke;border-radius: 10px;border: 2px solid var(--blue1); padding: 10px;">
                <h3 style="text-align: center;padding: 10px;margin: -10px;background-color: var(--blue1);color: whitesmoke;border-top-left-radius: 8px;border-top-right-radius: 8px;">Announcements</h3>
                <br>
                <form action="" id="ancmt">
                    <h5 style="color: var(--blue1);">Send Announcement as mail </h5>
                    <textarea id="data" rows="5" name="data" style="border: 1px solid black;border-radius: 6px;padding: 6px;width: 100%; background-color: white;" required placeholder="type here... "></textarea><br><br>
                    <div style="display: flex; justify-content: center;"> <input type="submit" style="width: 200px;align-self: center;background-color: orange; border-radius: 3px;color:white;" value="Post">
                    </div>
                </form>
            </div>

        </div>






        <br>
        <br>
        <br>
        <br>




        <%- include('./footer.ejs',{user : user}); %>





            <script>
                var searchForm = document.getElementById("admin_product");
                var search_user = document.getElementById("user_search");


                search_user.addEventListener("submit", function(e) {

                    e.preventDefault()


                    const searchQuery = e.target[0].value;


                    fetch(`http://localhost:3000/api/search_admin_user?search=${searchQuery}`).then(response => {
                            if (response.ok) {
                                return response.json(); //converting back to object
                            }
                            throw new Error('Network response was not ok.');
                        })
                        .then(data => {
                            // Call createAdCards function to create ad cards on page load
                            let adCardsContain = document.getElementById("user_change");
                            empty(adCardsContain)

                            // console.log("hi")
                            CreateUser(data.data)
                        })
                        .catch(error => {
                            console.error('There was a problem with the fetch operation:', error);
                        });



                });


                searchForm.addEventListener("submit", function(e) {
                    e.preventDefault()
                    console.log(e)


                    const searchQuery = e.target[0].value;
                    // alert(searchQuery)


                    fetch(`http://localhost:3000/api/admin_product?search=${searchQuery}`).then(response => {
                            if (response.ok) {
                                return response.json(); //converting back to object
                            }
                            throw new Error('Network response was not ok.');
                        })
                        .then(data => {
                            // Call createAdCards function to create ad cards on page load
                            let adCardsContain = document.getElementById("add-container-1");
                            empty(adCardsContain)
                            createAdCards(data.data)
                        })
                        .catch(error => {
                            console.error('There was a problem with the fetch operation:', error);
                        });



                });

                fetch('http://localhost:3000/api/products').then(response => {

                        if (response.ok) {
                            return response.json(); //converting back to object
                        }
                        throw new Error('Network response was not ok.');
                    })
                    .then(data => {
                        // Call createAdCards function to create ad cards on page load
                        createAdCards(data.data)
                    })
                    .catch(error => {
                        console.error('There was a problem with the fetch operation:', error);
                    });



                fetch('http://localhost:3000/api/allusers').then(response => {

                        if (response.ok) {
                            return response.json(); //converting back to object
                        }
                        throw new Error('Network response was not ok.');
                    })
                    .then(data => {
                        // Call createAdCards function to create ad cards on page load
                        CreateUser(data.data)
                    })
                    .catch(error => {
                        console.error('There was a problem with the fetch operation:', error);
                    });


                const CreateUser = (users) => {

                    const temp = document.getElementById("user_change")



                    users.forEach(ad => {
                        const link_user = document.createElement('a')
                        link_user.innerHTML = ad.name
                        link_user.classList = "list-group-item list-group-item-action"
                        link_user.href = `/api/user/adminlink/${ad._id}/admin/<%- user._id %>`
                        temp.appendChild(link_user)

                    })

                }


                function empty(element) {
                    while (element.firstElementChild) {
                        element.firstElementChild.remove();
                    }
                }

                // Function to create ad cards dynamically
                const createAdCards = (ads) => {
                    //ads is an array of all ads
                    const adCardsContainer = document.getElementById("add-container-1");
                    ads.forEach(ad => {
                        const adBody = document.createElement("div");
                        adBody.classList.add("c-body");
                        adBody.style.cssText = 'background-color: white; width: 100%;';
                        adBody.innerHTML = `
        <h3 class="card-title">${ad.name}</h3>
            <p class="card-text"> ${ad.price}</p>
            <button class="viewAd" onclick="getAdDetails('${ad._id}')">View Ad</button>
            
           
`;
                        const adCard = document.createElement("div");
                        adCard.classList.add("card");
                        adCard.style.cssText = "display: inline-block; width:210px; margin: 20px 0 0 20px; border-bottom: 6px solid orangered;"
                            // console.log(`''`)
                        adCard.innerHTML = `<img class="<img class="card-img-top"
            src="data:${ad.img_type};base64,${btoa(String.fromCharCode.apply(null,ad.img_content.data))}"
            alt="Card image" style="width: 208px;height: 230px;">`;
                        adCard.appendChild(adBody);
                        adCardsContainer.appendChild(adCard);
                    });
                };



                function getAdDetails(id) {
                    location.assign(`http://localhost:3000/api/admin_ads/${id}/admin/<%- user._id %>`)
                }
            </script>
            <!-- <script type="text/javascript" src="http://localhost:3000/admin_script.js"></script> -->
            <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
            <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
            <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
</body>

</html>